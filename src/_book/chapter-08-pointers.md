---
title:  "Указатели"
layout: "capter"

---

Когда мы вызываем функцию с аргументами, аргументы копируются в функцию:

    func zero(x int) {
        x = 0
    }
    func main() {
        x := 5
        zero(x)
        fmt.Println(x) // x всё еще равен 5
    }

В этой программе функция `zero` не изменяет оригинальую переменную `x` из функции `main`. Но что если мы хотим её изменить? Один из способов сделать это - использовать специальный тип данных - указатель:

    func zero(xPtr *int) {
        *xPtr = 0
    }
    func main() {
        x := 5
        zero(&x)
        fmt.Println(x) // x is 0
    }
   
Указатели указывают (прошу прощения за тавтологию) на участок в памяти, где хранится значение. Используя указатель (`*int`) в функции `zero` мы можем изменить значение оригинальной переменной.

### Операции * и &

В Go указатели представлены через оператор * (звёздочка), за которым следует тип хранимого значения. В функции `zero` `xPtr` является указателем на `int`.

`*` также использвется для «разименовывания» указателей. Когда мы пишем `*xPtr = 0`, то читаем это так: «храним `int` 0 в памяти, на которую указывает `xPtr`». Если вместо этого мы попробуем написать `xPtr = 0` то получим ошибку компиляции, потому что `xPtr` имеет тип не `int`, а `*int`. Соответсвтенно, ему может быть присовен только другой `*int`.

Также существует оператор `&`, который импользуется для получения адреса переменной. `&x` вернет `*int` (указатель на `int`) потому что `x` имеет тип `int`. Теперь мы можем изменять оригинальную переменную. `&x` в функции `main` и `xPtr` в функции `zero` указывают на однин и тот же участок в памяти.

### new

Другой способ получить указатель - использовать встроенную функцию `new`:

    func one(xPtr *int) {
        *xPtr = 1
    }
    func main() {
        xPtr := new(int)
        one(xPtr)
        fmt.Println(*xPtr) // x is 1
    }
    
`new` принимает аргумнтом тип, выделяет для него память для него и возвращает указатель на эту память.

В некоторых языках программирования существует существенная разница между использоваеним `new` и `&`, и в них нужно удалять всё, что было создано с помощью `new`. Go не такой, Go хороший. Go - язык с автоматической сборкой мусора, это означает что память очищается автоматически, когда на неё не остаётся ссылок на неё.

Указатели редко используются в Go для встроенных типов, но они будут часто фигурировать в следующей главе (Они черезвычайно полезны при работе со структурами).

## Задачи

*  Как получить адресс переменной?

*  Как присвоить значение указателю?

*  Как создать новый указатель?

*  Какое будет значение у переменной `x` после выполения программы:

        func square(x *float64) {
            *x = *x * *x
        }
        func main() {
            x := 1.5
            square(&x)
        }

*  Напишите программу, которая меняет местами два числа (`x := 1; y := 2; swap(&x, &y)` должно дать `x=2` и `y=1`).
